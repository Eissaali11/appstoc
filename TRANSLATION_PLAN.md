# خطة إضافة الترجمة (عربي / إنجليزي) للتطبيق

## الهدف
دعم لغتين في التطبيق: **العربية** (الافتراضية) و**الإنجليزية**، مع إمكانية تغيير اللغة من داخل التطبيق وحفظ اختيار المستخدم.

---

## 1. اختيار آلية الترجمة

| الخيار | المميزات | العيوب |
|--------|----------|--------|
| **GetX Translations** | مدمج مع GetX، تغيير اللغة دون إعادة تشغيل، بسيط | المفاتيح في الكود (لا ملفات .arb منفصلة) |
| **Flutter l10n (.arb)** | معيار Flutter، توليد كود آلي، دعم أدوات الترجمة | يحتاج `flutter gen-l10n` وتكامل مع GetX أضعف |
| **easy_localization** | ملفات JSON، ديناميكية | إضافة حزمة خارجية وربط مع GetX |

**التوصية:** استخدام **GetX Translations** لأن التطبيق يعتمد GetX بالفعل، وتغيير اللغة فوراً بدون إعادة بناء، مع حفظ اللغة في التخزين المحلي.

---

## 2. هيكل الملفات المقترح

```
lib/
├── core/
│   └── l10n/                    # الترجمة
│       ├── app_translations.dart   # تسجيل كل اللغات (GetX)
│       ├── ar.dart                 # النصوص العربية
│       └── en.dart                 # النصوص الإنجليزية
├── app.dart
└── ...
```

---

## 3. مراحل التنفيذ

### المرحلة 1: البنية التحتية (Infrastructure)

1. **إنشاء ملفات الترجمة**
   - `lib/core/l10n/ar.dart`: خريطة مفاتيح → نصوص عربية.
   - `lib/core/l10n/en.dart`: خريطة مفاتيح → نصوص إنجليزية.
   - `lib/core/l10n/app_translations.dart`: كلاس يرجع قائمة ترجمات GetX (ar, en).

2. **تعديل `app.dart`**
   - إضافة `translations: AppTranslations.translations`.
   - إضافة `locale` و `fallbackLocale` (من التخزين أو افتراضي `ar`).
   - إضافة `supportedLocales: [Locale('ar'), Locale('en')]`.
   - جعل `Directionality` يعتمد على اللغة: `ar` → RTL، `en` → LTR (استخدام `Get.locale` أو تمرير `context`).

3. **حفظ لغة المستخدم**
   - في `LocalCache` أو `SecureStorage`: مفتاح مثل `app_language` بقيمة `ar` أو `en`.
   - عند بدء التطبيق: قراءة القيمة وتطبيق `Get.updateLocale(Locale(...))` وتحديث `Directionality` بناءً عليها.

---

### المرحلة 2: فهرس النصوص (جرد المفاتيح)

تصنيف النصوص حسب الشاشة/المكون:

| المنطقة | أمثلة نصوص | المفتاح المقترح (مثال) |
|---------|------------|-------------------------|
| **التطبيق عام** | Stock، تسجيل الخروج | `appTitle`, `logout` |
| **تسجيل الدخول** | تسجيل الدخول، البريد، كلمة المرور، دخول | `loginTitle`, `email`, `password`, `loginButton` |
| **لوحة التحكم** | لوحة التحكم، المخزون الثابت، طلب مخزون | `dashboard`, `fixedInventory`, `requestInventory` |
| **القائمة الجانبية** | كل عناصر القائمة + الملف الشخصي، من نحن | `drawerDashboard`, `drawerProfile`, `aboutUs` |
| **طلب المخزون** | طلب جديد، طلباتي، تمت الموافقة، قيد الانتظار، مرفوض | `newRequest`, `myRequests`, `approved`, `pending`, `rejected` |
| **الأجهزة المستلمة** | الأجهزة المستلمة، إدخال جهاز، لا توجد أجهزة | `receivedDevices`, `submitDevice`, `noDevices` |
| **الملف الشخصي** | الاسم، البريد، تغيير اللغة | `profile`, `name`, `email`, `changeLanguage` |
| **من نحن** | العناوين والفقرات (يمكن تجميعها تحت بادئة `about.*`) | `aboutTitle`, `aboutVision`, … |
| **رسائل عامة** | نجح، خطأ، تأكيد، إلغاء، تحميل… | `success`, `error`, `confirm`, `cancel`, `loading` |

يُنصح بإنشاء جدول (مثل Excel أو ملف `KEYS.md`) يسرد كل مفتاح مع النص العربي والإنجليزي قبل الكتابة في الكود.

---

### المرحلة 3: استبدال النصوص في الواجهات

1. **استبدال النصوص الثابتة**
   - استبدال أي `Text('نص عربي')` بـ `Text('key'.tr)` بعد إضافة المفتاح في `ar.dart` و `en.dart`.
   - نفس الشيء لـ `title`, `labelText`, `hintText`, `Snackbar`، رسائل الأخطاء في الـ Controllers.

2. **النصوص الديناميكية (مع متغيرات)**
   - استخدام معاملات في GetX: مثلاً `'itemCount'.trParams({'count': '5'})` أو `'welcome'.trParams({'name': user.name})`.
   - في ملف الترجمة: `'itemCount': 'عدد العناصر: {{count}}'` و `'itemCount': 'Items: {{count}}'`.

3. **التواريخ والأرقام**
   - استخدام `intl` (موجود في المشروع) لتهيئة `DateFormat` حسب الـ locale (عربي/إنجليزي) عند عرض التاريخ والوقت.

4. **حالات من الـ API**
   - نصوص مثل "تمت الموافقة"، "مرفوض"، "قيد الانتظار": إما أن تأتي من الترجمة حسب الحالة (مفتاح مثل `status_approved`, `status_rejected`, `status_pending`) أو تبقى من الـ backend وتُعرض كما هي (حسب متطلباتك).

---

### المرحلة 4: واجهة تغيير اللغة

1. **مكان الخيار**
   - إما في **الملف الشخصي** (Profile): زر أو قائمة "اللغة / Language" تختار بين العربية والإنجليزية.
   - أو في **الإعدادات** إن وُجدت لاحقاً.

2. **التنفيذ**
   - عند الاختيار:
     - حفظ القيمة في التخزين المحلي (`ar` / `en`).
     - استدعاء `Get.updateLocale(Locale('ar'))` أو `Locale('en')`.
     - تحديث اتجاه الواجهة (RTL/LTR)؛ إن كان `Directionality` مربوطاً بـ `Get.locale` أو بـ `Obx` على الـ locale فسيحدث تلقائياً بعد `updateLocale`.

3. **إعادة بناء الشاشة**
   - مع GetX عادةً كل الـ `'.tr'` تُحدَّث تلقائياً بعد `updateLocale`؛ تأكد أن الـ `GetMaterialApp` لا يثبت `locale` مرة واحدة عند البدء فقط، بل يقرأ من Controller أو من التخزين ثم يحدّث عند تغيير اللغة.

---

### المرحلة 5: الاختبار والمراجعة

1. **اختبار كل شاشة**
   - التبديل بين العربية والإنجليزية والتأكد من عدم بقاء نصوص ثابتة بدون ترجمة.
2. **اتجاه الواجهة**
   - العربية: RTL، الإنجليزية: LTR.
3. **حفظ اللغة**
   - إغلاق التطبيق وإعادة فتحه والتأكد أن اللغة المحفوظة تُطبَّق من أول الشاشة.
4. **التواريخ والأرقام**
   - عرض تواريخ وأرقام بتنسيق يلائم كل لغة إن وُجدت.

---

## 4. ملخص الخطوات العملية (Checklist)

- [ ] إنشاء `lib/core/l10n/ar.dart` و `lib/core/l10n/en.dart` و `lib/core/l10n/app_translations.dart`.
- [ ] إضافة مفتاح `app_language` في التخزين المحلي وقراءته عند بدء التطبيق.
- [ ] تعديل `app.dart`: ربط `translations`, `locale`, `fallbackLocale`, `supportedLocales`, و `Directionality` حسب اللغة.
- [ ] جرد كل النصوص في التطبيق وتقسيمها لمفاتيح (جدول مفاتيح عربي/إنجليزي).
- [ ] ملء `ar.dart` و `en.dart` بكل المفاتيح.
- [ ] استبدال النصوص في الشاشات والمكونات بـ `'key'.tr` أو `.trParams`.
- [ ] إضافة واجهة تغيير اللغة (مثلاً من الملف الشخصي) وحفظ الاختيار وتحديث الـ locale والاتجاه.
- [ ] اختبار التبديل بين اللغتين واتجاه الواجهة وحفظ اللغة بعد إعادة التشغيل.

---

## 5. أمثلة كود سريعة

### مثال: تسجيل اللغات في GetX (`app_translations.dart`)

```dart
import 'package:get/get.dart';
import 'ar.dart';
import 'en.dart';

class AppTranslations extends Translations {
  @override
  Map<String, Map<String, String>> get keys => {
    'ar': ar,
    'en': en,
  };
}
```

### مثال: ملف عربي `ar.dart`

```dart
const Map<String, String> ar = {
  'appTitle': 'Stock',
  'login': 'تسجيل الدخول',
  'email': 'البريد الإلكتروني',
  'password': 'كلمة المرور',
  'dashboard': 'لوحة التحكم',
  'logout': 'تسجيل الخروج',
  // ...
};
```

### مثال: ملف إنجليزي `en.dart`

```dart
const Map<String, String> en = {
  'appTitle': 'Stock',
  'login': 'Login',
  'email': 'Email',
  'password': 'Password',
  'dashboard': 'Dashboard',
  'logout': 'Logout',
  // ...
};
```

### مثال: استخدام في الواجهة

```dart
Text('login'.tr)
Text('welcome'.trParams({'name': user.name}))
```

### مثال: تغيير اللغة مع الحفظ

```dart
void setLocale(String languageCode) {
  Get.updateLocale(Locale(languageCode));
  LocalCache.setString('app_language', languageCode);
}
```

---

## 6. ترتيب الأولويات (إن رغبت بالتنفيذ على مراحل)

1. **أولاً:** البنية التحتية (ملفات الترجمة + ربط GetX + Directionality + حفظ اللغة).
2. **ثانياً:** الشاشات الأساسية (تسجيل الدخول، لوحة التحكم، القائمة الجانبية).
3. **ثالثاً:** شاشات المخزون وطلب المخزون والأجهزة المستلمة والملف الشخصي.
4. **رابعاً:** صفحة "من نحن" ورسائل الـ Snackbar والأخطاء.
5. **أخيراً:** مراجعة شاملة وتوحيد المفاتيح وإضافة أي نصوص ناقصة.

بعد تنفيذ هذه الخطة سيكون التطبيق يدعم العربية والإنجليزية مع إمكانية تغيير اللغة وحفظها.
