# ربط التطبيق بأي دومين دون تعديل الكود

## كيف يعمل

1. عند بدء التطبيق يُجلب **عنوان الـ API** من مصدر إعداد (Config).
2. إن وُجد عنوان محفوظ محلياً ولم تنتهِ صلاحيته (ساعة)، يُستخدم مباشرة.
3. وإلا يُطلب من **عنوان Config** ملف JSON بالشكل: `{"baseUrl": "https://عنوان-الخادم"}`
4. إن نجح الطلب يُحفظ العنوان ويُستخدم.
5. إن فشل (لا إنترنت أو الخادم معطل) يُستخدم آخر عنوان محفوظ، أو القيمة الافتراضية في الكود.

بهذا عند **تغيير الاستضافة أو الدومين** يكفي تحديث مصدر الإعداد (الملف أو الـ endpoint) وبدون إعادة نشر التطبيق.

---

## الخيار 1: إعداد من نفس الخادم (مثالي في البداية)

أضف في الخادم (Backend) مساراً يُرجع عنوان الـ API الحالي:

- **المسار المقترح:** `GET /api/config`
- **نوع المحتوى:** `application/json`
- **مثال الجواب:**

```json
{
  "baseUrl": "https://الدومين-الحالي-للمشروع"
}
```

لا يلزم أي تعديل في التطبيق؛ التطبيق يستخدم تلقائياً: `القيمة_الافتراضية + "/api/config"` كعنوان لجلب الإعداد.

عند نقل المشروع لاستضافة جديدة:
- انشر الخادم الجديد مع نفس المسار `GET /api/config` ونفس شكل الجواب.
- إذا أبقيت الخادم القديم يعمل، يمكنك جعله يُعيد من `/api/config` عنوان الخادم الجديد (redirect أو نفس الـ JSON للدومين الجديد).

---

## الخيار 2: عنوان Config ثابت (الأفضل لتغيير الدومين دون لمس التطبيق)

إذا أردت أن تغيّر الدومين **دون أي تعديل في التطبيق** حتى لو تغيّر أو أُوقف الخادم الحالي:

1. اختر **دوميناً ثابتاً** لا يتغير مع تغيير استضافة الـ API (مثل نطاق فرعي أو استضافة ملفات).
2. ضع هناك ملف JSON (مثلاً `app_config.json`) بالمحتوى:

```json
{
  "baseUrl": "https://الدومين-الجديد-بعد-النقل"
}
```

3. في المشروع افتح الملف:  
   `lib/core/api/api_config.dart`  
   وعدّل الثابت `stableConfigUrl` ليكون عنوان هذا الملف، مثلاً:

```dart
static const String? stableConfigUrl = 'https://config.example.com/app_config.json';
```

4. بعدها عند أي تغيير للدومين أو الاستضافة: عدّل **فقط محتوى الملف** على ذلك الدومين الثابت؛ لا حاجة لتعديل الكود أو إعادة نشر التطبيق.

---

## ملخص

| الهدف | الإجراء |
|--------|---------|
| تشغيل التطبيق مع الخادم الحالي | لا شيء؛ القيمة الافتراضية + اختيارياً إضافة `GET /api/config` في الخادم. |
| تغيير الدومين مع بقاء الخادم القديم يعمل | إضافة أو تعديل `GET /api/config` ليرجع الدومين الجديد. |
| تغيير الدومين دون الاعتماد على الخادم القديم | استخدام دومين ثابت لملف الإعداد وضبط `stableConfigUrl` مرة واحدة. |

---

## مسح الكاش (اختياري)

لإجبار التطبيق على جلب الإعداد من الخادم في التشغيل التالي (مثلاً بعد تغيير الدومين):

```dart
await ApiConfig.clearCache();
```

يمكن استدعاؤها من شاشة إعدادات أو من نقطة واحدة في التطبيق عند الحاجة.
